import{r as d,a as F,R as M}from"./react-vendor-nf7bT_Uh.js";import{S as q,C as B,L as J,D as V,Z as U,F as W}from"./icons-CxVzKgxD.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function h(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(t){if(t.ep)return;t.ep=!0;const n=h(t);fetch(t.href,n)}})();var _={exports:{}},b={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z=d,z=Symbol.for("react.element"),G=Symbol.for("react.fragment"),H=Object.prototype.hasOwnProperty,K=Z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y={key:!0,ref:!0,__self:!0,__source:!0};function E(x,i,h){var c,t={},n=null,l=null;h!==void 0&&(n=""+h),i.key!==void 0&&(n=""+i.key),i.ref!==void 0&&(l=i.ref);for(c in i)H.call(i,c)&&!Y.hasOwnProperty(c)&&(t[c]=i[c]);if(x&&x.defaultProps)for(c in i=x.defaultProps,i)t[c]===void 0&&(t[c]=i[c]);return{$$typeof:z,type:x,key:n,ref:l,props:t,_owner:K.current}}b.Fragment=G;b.jsx=E;b.jsxs=E;_.exports=b;var e=_.exports,y={},S=F;y.createRoot=S.createRoot,y.hydrateRoot=S.hydrateRoot;const g="http://localhost:8787";function Q(){const[x,i]=d.useState([]),[h,c]=d.useState([]),[t,n]=d.useState([]),[l,L]=d.useState([]),[O,N]=d.useState(!0),[p,j]=d.useState("cases"),[v,R]=d.useState({}),[P,$]=d.useState(0);d.useEffect(()=>{w(),A()},[]);const w=async()=>{try{const[s,r,a]=await Promise.all([fetch(`${g}/cases`),fetch(`${g}/evidence`),fetch(`${g}/metrics`)]);i(await s.json()),n(await r.json()),R(await a.json()),N(!1)}catch(s){console.error("Init failed:",s),N(!1)}},A=()=>{const s=new EventSource(`${g}/activity/stream`);return s.onmessage=r=>{const a=JSON.parse(r.data);c(u=>[a,...u].slice(0,50)),a.type==="connection_count"&&$(a.count),a.type==="case_solved"&&w()},s.onerror=()=>{console.log("Activity stream disconnected, reconnecting...")},()=>s.close()},I=async s=>{const r=t.find(a=>a.id===s);r&&(L(a=>[...a,r]),await fetch(`${g}/activity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"cart_add",evidence_id:s,timestamp:new Date().toISOString()})}))},T=async()=>{const s=l.map(m=>m.id),r=x.filter(m=>m.required_evidence.every(f=>s.includes(f)));if(r.length===0){alert("This evidence doesn't complete any cases yet");return}const a=await fetch(`${g}/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({evidence_ids:s,case_ids:r.map(m=>m.id)})}),{checkout_url:u}=await a.json();window.location.href=u},k=({caseData:s})=>{const r=t.filter(o=>s.required_evidence.includes(o.id)),a=l.map(o=>o.id),u=r.filter(o=>a.includes(o.id)).length,m=r.length,f=u===m;return e.jsxs("div",{className:`border-2 rounded-lg p-6 ${f?"border-green-500 bg-green-50":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold flex items-center gap-2",children:[f?e.jsx(B,{className:"text-green-600"}):e.jsx(J,{className:"text-gray-400"}),"Case #",s.number]}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.title})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Progress"}),e.jsxs("div",{className:"text-2xl font-bold",children:[u,"/",m]})]})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:s.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-700",children:"Required Evidence:"}),r.map(o=>e.jsxs("div",{className:`flex items-center justify-between p-2 rounded ${a.includes(o.id)?"bg-green-100":"bg-gray-100"}`,children:[e.jsx("span",{children:o.name}),e.jsxs("span",{className:"font-mono text-sm",children:["$",o.price]})]},o.id))]}),f&&e.jsxs("div",{className:"mt-4 p-4 bg-green-100 border border-green-300 rounded",children:[e.jsx("div",{className:"font-bold text-green-800 mb-2",children:"ðŸŽ‰ CASE SOLVED"}),e.jsx("p",{className:"text-sm text-green-700",children:s.solution})]})]})},D=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"text-blue-600"}),"Database Metrics (Neon Postgres)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 font-mono text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Total Cases"}),e.jsx("div",{className:"text-2xl font-bold",children:v.total_cases||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Solved Cases"}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:v.solved_cases||0})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:"Evidence Items"}),e.jsx("div",{className:"text-2xl font-bold",children:v.evidence_count||0})]})]})]}),e.jsxs("div",{className:"bg-purple-50 border-2 border-purple-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"text-purple-600"}),"Live Activity (MongoDB Atlas)"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Active Connections"}),e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:P})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:h.map((s,r)=>e.jsxs("div",{className:"bg-white p-2 rounded border text-sm font-mono",children:[e.jsx("span",{className:"text-gray-500",children:new Date(s.timestamp).toLocaleTimeString()})," ",e.jsx("span",{className:"font-semibold",children:s.type})," ",e.jsx("span",{className:"text-gray-600",children:JSON.stringify(s.data)})]},r))})]}),e.jsxs("div",{className:"bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(W,{className:"text-yellow-600"}),"Shopify Integration"]}),e.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Storefront API:"}),e.jsx("span",{className:"text-green-600",children:"Connected"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Products Synced:"}),e.jsx("span",{children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cache Strategy:"}),e.jsx("span",{children:"Edge w/ 5min TTL"})]})]})]})]});return O?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold text-gray-400",children:"Loading Crime Lab..."})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-gray-900 text-white p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"ðŸ”¬ Imaginary Crime Lab"}),e.jsx("p",{className:"text-gray-300",children:"Cases solve themselves when you collect all the evidence"}),e.jsx("div",{className:"mt-4 text-xs text-gray-400 font-mono",children:"Architecture: React (GitHub Pages) â†’ Workers (Edge) â†’ Neon (Postgres) + MongoDB (Live) + Shopify (Commerce)"})]})}),e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex gap-4",children:[e.jsx("button",{onClick:()=>j("cases"),className:`px-4 py-2 rounded font-semibold ${p==="cases"?"bg-blue-600 text-white":"bg-gray-100"}`,children:"Active Cases"}),e.jsx("button",{onClick:()=>j("evidence"),className:`px-4 py-2 rounded font-semibold ${p==="evidence"?"bg-blue-600 text-white":"bg-gray-100"}`,children:"Evidence Store"}),e.jsx("button",{onClick:()=>j("internals"),className:`px-4 py-2 rounded font-semibold ${p==="internals"?"bg-blue-600 text-white":"bg-gray-100"}`,children:"System Internals"}),e.jsx("div",{className:"flex-1"}),e.jsxs("button",{className:"px-4 py-2 rounded bg-green-600 text-white font-semibold flex items-center gap-2",children:[e.jsx(q,{size:20}),"Cart (",l.length,")"]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[p==="cases"&&e.jsx("div",{className:"grid gap-6",children:x.map(s=>e.jsx(k,{caseData:s},s.id))}),p==="evidence"&&e.jsx("div",{className:"grid grid-cols-3 gap-6",children:t.map(s=>e.jsxs("div",{className:"border rounded-lg p-6 bg-white",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold",children:["$",s.price]}),e.jsx("button",{onClick:()=>I(s.id),className:"px-4 py-2 bg-blue-600 text-white rounded font-semibold hover:bg-blue-700",children:"Add to Cart"})]})]},s.id))}),p==="internals"&&e.jsx(D,{})]}),l.length>0&&e.jsxs("div",{className:"fixed bottom-8 right-8 bg-white border-2 border-gray-300 rounded-lg shadow-2xl p-6 w-96",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Cart Summary"}),e.jsx("div",{className:"space-y-2 mb-4 max-h-48 overflow-y-auto",children:l.map((s,r)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:s.name}),e.jsxs("span",{children:["$",s.price]})]},r))}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between font-bold mb-4",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["$",l.reduce((s,r)=>s+parseFloat(r.price),0).toFixed(2)]})]}),e.jsx("button",{onClick:T,className:"w-full bg-green-600 text-white py-3 rounded font-bold hover:bg-green-700",children:"Purchase & Solve Cases"})]})]})]})}const C=document.getElementById("loading");C&&C.classList.add("hidden");y.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(Q,{})}));
//# sourceMappingURL=index-DyyTaHUm.js.map
