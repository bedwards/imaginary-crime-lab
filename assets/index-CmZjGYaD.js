import{r as o,a as U,R as V}from"./react-vendor-nf7bT_Uh.js";import{S as H,D as G,Z as W,T as q,A as S,F as Q}from"./icons-WBUQY2dM.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const m of n.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function b(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(l){if(l.ep)return;l.ep=!0;const n=b(l);fetch(l.href,n)}})();var k={exports:{}},f={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X=o,K=Symbol.for("react.element"),Y=Symbol.for("react.fragment"),ee=Object.prototype.hasOwnProperty,se=X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,te={key:!0,ref:!0,__self:!0,__source:!0};function I(x,d,b){var i,l={},n=null,m=null;b!==void 0&&(n=""+b),d.key!==void 0&&(n=""+d.key),d.ref!==void 0&&(m=d.ref);for(i in d)ee.call(d,i)&&!te.hasOwnProperty(i)&&(l[i]=d[i]);if(x&&x.defaultProps)for(i in d=x.defaultProps,d)l[i]===void 0&&(l[i]=d[i]);return{$$typeof:K,type:x,key:n,ref:m,props:l,_owner:se.current}}f.Fragment=Y;f.jsx=I;f.jsxs=I;k.exports=f;var e=k.exports,y={},C=U;y.createRoot=C.createRoot,y.hydrateRoot=C.hydrateRoot;const u="https://crime-lab.brian-mabry-edwards.workers.dev";function re(){const[x,d]=o.useState([]),[b,i]=o.useState([]),[l,n]=o.useState([]),[m,w]=o.useState(!0),[h,A]=o.useState("cases"),[j,L]=o.useState({}),[D,P]=o.useState(0),[Z,M]=o.useState([]),[p,T]=o.useState(null);o.useEffect(()=>{Promise.all([fetch(`${u}/cases`).then(s=>s.json()),fetch(`${u}/evidence`).then(s=>s.json()),fetch(`${u}/metrics`).then(s=>s.json())]).then(([s,t,r])=>{d(s),i(t),L(r),w(!1)}).catch(s=>{console.error("Failed to load data:",s),w(!1)})},[]),o.useEffect(()=>{if(h!=="internals")return;const s=async()=>{try{const a=await(await fetch(`${u}/activity/analytics`)).json();T(a)}catch(r){console.error("Failed to fetch analytics:",r)}};s();const t=setInterval(s,5e3);return()=>clearInterval(t)},[h]),o.useEffect(()=>{if(h!=="internals")return;const s=new EventSource(`${u}/activity/stream`);return s.onmessage=t=>{const r=JSON.parse(t.data);r.type==="connection_count"?P(r.count):r.type!=="connected"&&M(a=>[r,...a].slice(0,20))},s.onerror=()=>{console.error("SSE connection error"),s.close()},()=>s.close()},[h]);const N=async(s,t)=>{try{await fetch(`${u}/activity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:s,data:{...t,session_id:sessionStorage.getItem("session_id")||(()=>{const r=crypto.randomUUID();return sessionStorage.setItem("session_id",r),r})()}})})}catch(r){console.error("Failed to log activity:",r)}},O=s=>{n(t=>[...t,s]),N("cart_add",{evidence_id:s.id})},R=s=>{n(t=>t.filter(r=>r.id!==s)),N("cart_remove",{evidence_id:s})},B=async()=>{if(l.length===0)return;const s=l.map(r=>r.variant_id),t=_();try{const a=await(await fetch(`${u}/checkout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({variant_ids:s,case_ids:t})})).json();a.checkout_url&&(window.location.href=a.checkout_url)}catch(r){console.error("Checkout failed:",r)}},_=()=>{const s=new Set(l.map(t=>t.id));return x.filter(t=>{var r;return!t.solved_at&&((r=t.required_evidence)==null?void 0:r.every(a=>s.has(a)))}).map(t=>t.id)},$=()=>e.jsx("div",{className:"space-y-6",children:x.map(s=>{var a,c;const t=((a=s.required_evidence)==null?void 0:a.filter(g=>l.some(v=>v.id===g)))||[],r=s.required_evidence?t.length/s.required_evidence.length*100:0;return e.jsxs("div",{className:`bg-white rounded-2xl border-2 p-6 shadow-lg hover:shadow-xl transition-all duration-200 ${s.solved_at?"border-green-400 bg-green-50":"border-blue-400"}`,onClick:()=>N("case_viewed",{case_id:s.id}),children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-1",children:s.title}),e.jsx("div",{className:"text-sm text-slate-500 font-mono",children:s.number})]}),s.solved_at&&e.jsx("span",{className:"px-4 py-2 bg-green-500 text-white text-sm font-bold rounded-full",children:"SOLVED âœ“"})]}),e.jsx("p",{className:"text-slate-700 mb-4",children:s.description}),!s.solved_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2 flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600",children:"Evidence Collected:"}),e.jsxs("span",{className:"font-bold text-blue-600",children:[t.length," / ",((c=s.required_evidence)==null?void 0:c.length)||0]})]}),e.jsx("div",{className:"h-3 bg-slate-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all duration-500",style:{width:`${r}%`}})})]}),s.solved_at&&e.jsxs("div",{className:"mt-4 bg-white/80 border-2 border-green-300 rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-green-700 mb-1 font-semibold",children:"SOLUTION:"}),e.jsx("div",{className:"text-slate-800",children:s.solution})]})]},s.id)})}),z=()=>{const s=_();return e.jsxs("div",{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(t=>{const r=l.some(a=>a.id===t.id);return e.jsxs("div",{className:"bg-white rounded-xl border-2 border-slate-300 p-5 shadow-md hover:shadow-xl transition-all duration-200 hover:-translate-y-1",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-2",children:t.name}),e.jsx("p",{className:"text-sm text-slate-600 mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["$",t.price]}),e.jsx("button",{onClick:()=>r?R(t.id):O(t),className:`px-4 py-2 rounded-lg font-semibold transition-colors ${r?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-600 text-white hover:bg-blue-700"}`,children:r?"Remove":"Add to Cart"})]})]},t.id)})}),l.length>0&&e.jsxs("div",{className:"fixed bottom-6 right-6 bg-white rounded-2xl border-2 border-blue-400 p-6 shadow-2xl max-w-md",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(H,{size:24,className:"text-blue-600"}),e.jsxs("h3",{className:"text-xl font-bold",children:["Cart (",l.length," items)"]})]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto mb-4",children:l.map(t=>e.jsxs("div",{className:"flex justify-between text-sm py-2 border-b",children:[e.jsx("span",{children:t.name}),e.jsxs("span",{className:"font-bold",children:["$",t.price]})]},t.id))}),e.jsx("div",{className:"border-t-2 pt-4 mb-4",children:e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-blue-600",children:["$",l.reduce((t,r)=>t+parseFloat(r.price),0).toFixed(2)]})]})}),s.length>0&&e.jsxs("div",{className:"bg-green-100 border border-green-300 rounded-lg p-3 mb-4",children:[e.jsxs("div",{className:"text-sm text-green-800 font-semibold mb-1",children:["âœ“ Will solve ",s.length," case(s)"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Purchase to automatically mark cases as solved"})]}),e.jsx("button",{onClick:B,className:"w-full bg-gradient-to-r from-blue-600 to-cyan-600 text-white py-3 rounded-xl font-bold hover:from-blue-700 hover:to-cyan-700 transition-all duration-200 shadow-lg",children:"Purchase Evidence"})]})]})},F=()=>{var s,t,r;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-100 border-2 border-blue-300 rounded-2xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2 text-blue-900",children:[e.jsx(G,{size:24}),"Database Metrics (Neon Postgres)"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-blue-700 mb-1",children:"Total Cases"}),e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:j.total_cases||0})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-green-700 mb-1",children:"Solved Cases"}),e.jsx("div",{className:"text-3xl font-bold text-green-700",children:j.solved_cases||0})]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl p-4",children:[e.jsx("div",{className:"text-sm text-purple-700 mb-1",children:"Evidence Items"}),e.jsx("div",{className:"text-3xl font-bold text-purple-700",children:j.evidence_count||0})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-100 border-2 border-purple-300 rounded-2xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2 text-purple-900",children:[e.jsx(W,{size:24}),"Live Activity Stream (MongoDB SSE)"]}),e.jsxs("div",{className:"bg-white/70 backdrop-blur-sm rounded-xl p-4 mb-4",children:[e.jsx("div",{className:"text-sm text-purple-700 mb-1",children:"Active Sessions (Last 30s)"}),e.jsxs("div",{className:"text-4xl font-bold text-purple-800 flex items-center gap-2",children:[D,e.jsx("span",{className:"w-3 h-3 bg-purple-500 rounded-full animate-pulse"})]})]}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:Z.map((a,c)=>{var g,v;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm p-3 rounded-xl text-xs font-mono border border-purple-200",children:[e.jsx("span",{className:"text-purple-600",children:new Date(a.timestamp).toLocaleTimeString()})," Â· ",e.jsx("span",{className:"font-semibold text-purple-900",children:a.type}),((g=a.data)==null?void 0:g.case_id)&&e.jsxs("span",{className:"text-purple-700",children:[" Â· Case ",a.data.case_id]}),((v=a.data)==null?void 0:v.evidence_id)&&e.jsxs("span",{className:"text-purple-700",children:[" Â· ",a.data.evidence_id]})]},c)})})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-100 border-2 border-emerald-300 rounded-2xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2 text-emerald-900",children:[e.jsx(q,{size:24}),"Top Cases (Last 24h) - MongoDB Aggregation"]}),e.jsx("div",{className:"space-y-2",children:((s=p.top_cases)==null?void 0:s.length)>0?p.top_cases.map((a,c)=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm p-4 rounded-xl border border-emerald-200 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-emerald-900",children:["Case ",a.case_id]}),e.jsxs("div",{className:"text-xs text-emerald-700",children:["Last viewed: ",new Date(a.last_viewed).toLocaleTimeString()]})]}),e.jsxs("div",{className:"text-2xl font-bold text-emerald-600",children:[a.views," views"]})]},c)):e.jsx("div",{className:"text-center text-emerald-700 py-4",children:"No case views yet"})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-50 to-amber-100 border-2 border-orange-300 rounded-2xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2 text-orange-900",children:[e.jsx(S,{size:24}),"Evidence Engagement Heatmap - MongoDB Aggregation"]}),e.jsx("div",{className:"space-y-2",children:((t=p.top_evidence)==null?void 0:t.length)>0?p.top_evidence.map((a,c)=>{const g=Math.max(...p.top_evidence.map(J=>J.cart_adds)),v=a.cart_adds/g*100;return e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm p-3 rounded-xl border border-orange-200",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-orange-900",children:a.evidence_id}),e.jsxs("span",{className:"text-orange-700 font-bold",children:[a.cart_adds," adds"]})]}),e.jsx("div",{className:"h-2 bg-orange-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-amber-500",style:{width:`${v}%`}})})]},c)}):e.jsx("div",{className:"text-center text-orange-700 py-4",children:"No cart activity yet"})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-rose-50 to-pink-100 border-2 border-rose-300 rounded-2xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2 text-rose-900",children:[e.jsx(S,{size:24}),"Activity Type Breakdown (24h) - MongoDB Aggregation"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:(r=p.activity_types)==null?void 0:r.map((a,c)=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-rose-200",children:[e.jsx("div",{className:"text-xs text-rose-700 mb-1 uppercase",children:a.type}),e.jsx("div",{className:"text-3xl font-bold text-rose-800",children:a.count})]},c))})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-yellow-100 border-2 border-amber-300 rounded-2xl p-6 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2 text-amber-900",children:[e.jsx(Q,{size:24}),"Shopify Integration"]}),e.jsxs("div",{className:"space-y-3 bg-white/70 backdrop-blur-sm rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-amber-800",children:"Storefront API:"}),e.jsx("span",{className:"px-3 py-1 bg-green-500 text-white text-xs font-bold rounded-full",children:"CONNECTED"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-amber-800",children:"Products Synced:"}),e.jsx("span",{className:"font-bold text-amber-900",children:b.length})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-amber-800",children:"Cache Strategy:"}),e.jsx("span",{className:"font-mono text-xs text-amber-700",children:"Edge w/ 5min TTL"})]})]})]})]})};return m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-cyan-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4 animate-bounce",children:"ðŸ”¬"}),e.jsx("div",{className:"text-3xl font-bold text-white",children:"Loading Crime Lab..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-r from-slate-900 via-blue-900 to-cyan-900 text-white",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48cGF0dGVybiBpZD0iZ3JpZCIgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBwYXR0ZXJuVW5pdHM9InVzZXJTcGFjZU9uVXNlIj48cGF0aCBkPSJNIDQwIDAgTCAwIDAgMCA0MCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJyZ2JhKDI1NSwyNTUsMjU1LDAuMDUpIiBzdHJva2Utd2lkdGg9IjEiLz48L3BhdHRlcm4+PC9kZWZzPjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JpZCkiLz48L3N2Zz4=')] opacity-20"}),e.jsxs("div",{className:"relative max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsx("div",{className:"text-6xl",children:"ðŸ”¬"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-200 via-cyan-200 to-teal-200 leading-tight",children:"Imaginary Crime Lab"}),e.jsx("p",{className:"text-cyan-200 text-lg mt-2",children:"Cases solve themselves when you collect all the evidence"})]})]}),e.jsx("div",{className:"mt-6 text-xs text-cyan-300/70 font-mono bg-black/20 backdrop-blur-sm rounded-lg px-4 py-2 inline-block",children:"React â†’ Workers â†’ Neon (Postgres) + MongoDB (Analytics) + Shopify (Commerce)"})]})]}),e.jsx("div",{className:"bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50 shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-4 flex items-center gap-3",children:[{id:"cases",label:"Active Cases",icon:"ðŸ”"},{id:"evidence",label:"Evidence Store",icon:"ðŸ“¦"},{id:"internals",label:"System Internals",icon:"âš™ï¸"}].map(s=>e.jsxs("button",{onClick:()=>A(s.id),className:`px-5 py-2.5 rounded-xl font-semibold transition-all duration-200 flex items-center gap-2 ${h===s.id?"bg-blue-600 text-white shadow-lg":"bg-slate-100 text-slate-700 hover:bg-slate-200"}`,children:[e.jsx("span",{children:s.icon}),s.label]},s.id))})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[h==="cases"&&e.jsx($,{}),h==="evidence"&&e.jsx(z,{}),h==="internals"&&e.jsx(F,{})]})]})}const E=document.getElementById("loading");E&&E.classList.add("hidden");y.createRoot(document.getElementById("root")).render(e.jsx(V.StrictMode,{children:e.jsx(re,{})}));
//# sourceMappingURL=index-CmZjGYaD.js.map
